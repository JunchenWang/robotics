% Rz	Ry	Rx	Tx	Ty	Tz  欧拉角顺序是 ZYX 单位degree
NDIreadings = [
    48.6673412	-74.1666476	-49.411442	-26.063	16.336	-1814.241
58.7227656	-70.1520134	-59.0061148	-26.284	16	-1815.902
33.2249332	-77.4722186	-34.3667343	-25.636	16.623	-1812.264
65.4807406	-65.6574483	-65.3135091	-26.574	15.444	-1817.468
10.6201595	-79.4509436	-12.1690511	-25.278	16.684	-1809.943
70.197042	-60.9865265	-69.5813546	-26.792	14.728	-1819.035
-17.4132336	-79.3376631	15.4238619	-24.74	16.501	-1807.4
53.2676908	-75.2306961	-49.0826859	-28.195	24.837	-1812.836
44.3857114	-73.1626684	-50.0684991	-24.553	7.719	-1815.486
58.1583955	-76.3089253	-49.0522416	-30.879	33.013	-1811.332
40.3706402	-72.1987743	-50.9405463	-24.031	-0.838	-1816.433
63.8551755	-77.2676541	-49.7895749	-34.416	40.896	-1809.794
36.6185285	-71.196825	-52.1665255	-24.147	-9.593	-1817.284
38.0461692	-70.6879663	-37.6634891	-28.4	17.387	-1822.321
64.9659711	-76.7291571	-66.7893295	-24.222	15.34	-1805.765
30.8560952	-66.7265155	-29.3840415	-31.421	18.331	-1830.161
86.2727407	-77.8029234	-89.1720462	-23.321	14.42	-1797.196
26.0839114	-62.4606131	-23.466748	-35.286	19.347	-1837.694
108.0561056	-77.0178292	-112.0417254	-23.179	13.453	-1788.697

];

% x, y, z, Rx, Ry,Rz 欧拉角顺序是 XYZ 单位degree
OmegaReadings = [
48.223	20.418	23.17	0.18	0.63	0.03
48.125	20.311	23.12	0.09	0.63	5.16
48.331	20.414	23.145	0.18	0.63	-4.83
48.104	20.185	23.184	0.09	0.72	10.29
48.364	20.464	23.172	0.18	0.63	-9.78
48.29	19.858	23.234	0.09	0.72	14.97
48.799	20.407	23.173	0.27	0.54	-14.82
48.262	20.28	23.374	-0.18	5.49	0.12
48.234	20.241	23.045	0.54	-4.32	0.12
48.364	20.292	23.387	-0.54	10.53	0.12
48.178	20.244	23.076	0.81	-9.45	0.12
48.415	20.323	23.476	-0.81	15.48	0.21
48.123	20.27	22.981	1.17	-14.49	0.21
48.164	20.357	23.233	-4.86	0.36	0.03
48.196	20.289	23.144	5.13	0.81	0.12
48.181	20.392	23.222	-9.72	0.09	-0.06
48.326	20.191	23.134	10.17	1.08	0.12
48.303	20.37	23.312	-14.76	-0.18	-0.06
48.293	20.206	23.113	15.21	1.35	0.03


];


A = zeros(6, 18);
B = zeros(6, 18);
validateB = zeros(6, 18);
validateBonOmega = zeros(6, 18);


for n = 1:18
  A(1:3,n) =  NDIreadings(n,1:3)/180 * pi'   ;
  
  rotm = eul2rotm(OmegaReadings(n,4:6)/180 * pi,'XYZ');
  zyx = rotm2eul(rotm, 'ZYX');
  
  B(1:3,n) = zyx'   ;
    
end

[transformation, err] =  HandEyeCalibration(A,B,2);

% ndi2omegaRotm = eul2rotm(transformation(1:3,1)', 'ZYX');
ndiRef = eul2rotm( NDIreadings(1,1:3)/180 * pi,'ZYX');
ndi2omegaRotm = RotationByAxisAngleRep(transformation(1:3));
for n = 2: 18
    ndiR = eul2rotm( NDIreadings(n,1:3)/180 * pi,'ZYX');
%     ndi2omegaRotm'*ndiRef'*ndiR*ndi2omegaRotm
    B_pre = rotm2eul(ndi2omegaRotm'*ndiRef'*ndiR*ndi2omegaRotm, 'xyz')/pi*180;
    validateB(1:3,n) = B_pre;
%     tmp = ndi2omegaRotm * eul2rotm( NDIreadings(n,1:3)/180 * pi,'ZYX') /eul2rotm( NDIreadings(1,1:3)/180 * pi,'ZYX') ;
%     
%     zyx = rotm2eul(tmp, 'ZYX');
%     validateB(1:3,n) = zyx' /pi * 180  ; 
%     
%     xyz = rotm2eul(tmp, 'XYZ');
%     validateBonOmega(1:3,n) = xyz' /pi * 180  ; 

end



