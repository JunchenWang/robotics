% Rz	Ry	Rx	Tx	Ty	Tz  欧拉角顺序是 ZYX 单位degree
NDIreadings = [
93.9507922	-83.0921135	178.2258798	82.355	-48.61	-1417.899
93.0796897	-78.3332439	-179.9721039	89.725	-41.549	-1377.573
99.8827985	-87.91926	171.3727814	74.779	-52.193	-1458.94
93.2053307	-73.3315869	-179.1676081	96.989	-30.848	-1337.874
-97.8922383	-87.2127466	8.2273912	67.234	-52.034	-1499.725
93.5406605	-68.2230256	-178.5599599	104.118	-16.574	-1299.017
-93.1283475	-82.3636552	2.5398918	59.75	-48.289	-1540.611
94.5356434	-82.1642057	172.7241618	41.122	-46.582	-1410.597
92.2908233	-83.9859151	-175.2002582	123.314	-47.113	-1425.608
94.6052239	-81.2119568	167.7354367	0.324	-40.855	-1403.879
89.0645805	-84.843445	-167.0958869	163.93	-41.993	-1433.872
93.5100057	-80.2047371	163.9174542	-39.843	-31.604	-1397.924
84.0951472	-85.7130307	-157.2250942	203.83	-33.356	-1442.581
128.6987148	-81.3385241	143.9124789	83.198	-48.643	-1418.14
56.8264282	-81.7361974	-145.0953947	81.412	-48.616	-1417.568
147.9960913	-77.5874409	125.0603479	84.142	-48.632	-1418.312
36.156721	-78.2078153	-124.8854062	80.532	-48.583	-1417.147
157.5358925	-73.3219809	115.953499	85.075	-48.611	-1418.4
25.675345	-73.9243604	-114.8563886	79.727	-48.542	-1416.594


];

% x, y, z, Rx, Ry,Rz 欧拉角顺序是 ZYX 单位 rad

robotReading = [
-525.9392109	0.027022237	-60.06421807	0	-1.570715177	7.70E-05
-525.9622255	0.019551588	-60.04835447	0	-1.570679452	0.087429142
-525.9639123	0.03343447	-60.04972661	0	-1.570718612	-0.087277342
-525.9930037	0.020032668	-60.02881474	0	-1.570581817	0.174701267
-525.9772131	0.034488442	-60.03403155	0	-1.570620394	-0.174549067
-525.9859883	0.008619735	-60.04010181	0	-1.570635285	0.261917586
-525.9895365	0.035241621	-60.03114359	0	-1.570603905	-0.261816717
-525.9623724	0.018217158	-60.05255336	0.001526655	-1.483387937	-0.001363532
-525.9014609	0.020770979	-60.10323391	3.140637911	-1.483209434	-3.140501165
-525.9499382	0.019630406	-60.05381534	6.73E-04	-1.396069073	-5.16E-04
-525.9294729	0.023948435	-60.05328755	3.141189339	-1.39615282	-3.141084312
-525.9529321	0.01917037	-60.06858256	4.80E-04	-1.308919499	-3.20E-04
-525.9294914	0.027613103	-60.05919404	3.14135416	-1.308837685	-3.141276169
-525.9559595	0.023254023	-60.05737586	1.569078903	-1.483363933	-1.568951215
-525.9545703	0.023159064	-60.05369126	-1.568914554	-1.483510542	1.569029921
-525.954091	0.022973163	-60.05354839	1.570046156	-1.396095847	-1.569914534
-525.9528687	0.022853169	-60.05376288	-1.56982724	-1.396236875	1.569933494
-525.9517664	0.02301363	-60.0530279	1.570365058	-1.30890728	-1.570225638
-525.9524855	0.022809841	-60.0520975	-1.570120675	-1.308999649	1.570218264



];

recordsCount = size(NDIreadings,1);

A = zeros(6, recordsCount);
B = zeros(6, recordsCount);
validateB = zeros(3, recordsCount);

B0 = eul2rotm(robotReading(1,4:6),'ZYX');
for n = 1:recordsCount
  A(1:3,n) =  NDIreadings(n,1:3)/180 * pi'   ;
  A(4:6,n) = NDIreadings(n,4:6);

  Bn =  eul2rotm(robotReading(n,4:6),'ZYX') * B0';
  B(1:3,n) = rotm2eul(Bn, 'ZYX')'  ;
  B(4:6, n) = robotReading(n, 1:3) - robotReading(1, 1:3);
    
end



[transformation, err] =  HandEyeCalibration(A,B,2);

% ndi2omegaRotm = eul2rotm(transformation(1:3,1)', 'ZYX');
TcameraMarker= eul2tform( NDIreadings(1,1:3)/180 * pi,'ZYX');
ndi2robotRotm = RotationByAxisAngleRep(transformation(1:3));

TflangeCamera = rotm2tform(ndi2robotRotm);

TflangeCamera(1:3,4) = transformation(4:6)';



TflangeMarker = TflangeCamera * TcameraMarker



